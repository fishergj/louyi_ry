<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <link th:href="@{/css/style1.css}" rel="stylesheet">
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
    <link th:href="@{/css/media.css}" rel="stylesheet">
    <link th:href="@{/css/jquery.fancybox.css}" rel="stylesheet">
    <link th:href="@{/css/font-awesome.min.css}" rel="stylesheet" >
    <link th:href="@{/css/owl.carousel.css}" rel="stylesheet">
    <link th:href="@{/css/owl.theme.css}" rel="stylesheet">
    <link th:href="@{/css/animate.css}" rel="stylesheet">
    <link th:href="@{/css/jpushmenu.css}" rel="stylesheet">

    <title>预约服务</title>
</head>
<body class="push-body">
<header id="main-navigation">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12"> <a href="#" class="navbar-brand pull-right"></a>
                <nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left"> <a href="#" class="push_nav_brand"></a>
                    <ul class="push_nav">
                        <!--<li><a class="active scroll" href="#HOME">首部</a></li>-->
                        <li><a class="scroll" href="#RESERVESEC">参观预约</a></li>
                        <li><a class="scroll" href="#RESERVEDSEC">当前预约</a></li>
                        <li><a class="scroll" href="#RECOMMENDSEC">留言建议</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</header>
<div class="container-fluid">
    <div class="main-button left">
        <button class="toggle-menu menu-left push-body"> <span></span> <span></span> <span></span> </button>
    </div>
</div>

<!-- HOME-->
<!--<div id="HOME" class="row section">
    <div class="container info text-center">
        <div class="row">
            <div class="col-xs-12 text-center">
                <div class="info_detail">
                    <div class="zoom">
                        <img th:src="@{/images/alex.jpg}" alt="alex">
                        <div class="zoom-overlay"></div>
                    </div>
                    <h3>Alexander Mia</h3>
                    <p>Creative Designer / Team Lead</p>
                </div>
            </div>
        </div>
        <div class="button"> <a href="#RESERVESEC" data-target="reserve" class="btn active scroll">快速预约</a>
    </div>
</div>-->

<!-- RESERVESEC -->
<div id="RESERVESEC" class="row section" th:height="798px">
    <div class="container contact">

        <div class="col-xs-12 text-center">
            <div class="animate fadeInRight">
                <div class="heading">
                    <h1>参观预约</h1>
                    <p>请认真填写参观预约信息</p>
                </div>
            </div>
            <div id="reserve">  <!-- col-xs-12 col-sm-9 col-md-6 col-lg-3   col-sm-6 -->
                <form class="form-horizontal" id="reserveFm">
                    <div class="form-group">
                        <label for="name" class="control-label col-sm-2 col-sm-offset-2" style="color:white">预约人姓名：</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control input-lg" id="name" name="name" placeholder="请填写预约人姓名">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="telephone" class="control-label col-sm-2 col-sm-offset-2" style="color:white">预约人电话：</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control input-lg" id="telephone" name="telephone" placeholder="请输入您的手机号码">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="adult" class="control-label col-sm-2 col-sm-offset-2" style="color:white">成人人数：</label>
                        <div class="col-sm-6">
                            <input type="number" class="form-control input-lg" id="adult" name="adult" placeholder="请输入成人人数" min="0" value="0" onblur="getTime()">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="child" class="control-label col-sm-2 col-sm-offset-2" style="color:white">儿童人数：</label>
                        <div class="col-sm-6">
                            <input type="number" class="form-control input-lg" id="child" name="child" placeholder="请输入儿童人数" min="0" value="0" onblur="getTime()">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="subscribe_time_id" class="control-label col-sm-2 col-sm-offset-2" style="color:white">参观时间选择：</label>
                        <div class="col-sm-6">
                            <select id="subscribe_time_id" name="subscribe_time_id"  class="form-control input-lg">
                                <!--<option th:each="time:${timeList}" th:value="${time.Id}" th:text="${time.time}"></option>-->
                                <!--<option value="-1">请选择合适的参观时间</option>-->
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="venue" class="control-label col-sm-2 col-sm-offset-2" style="color:white">预约场馆：</label>
                        <div class="col-sm-6">
                            <select class="form-control input-lg" id="venue" name="venue" placeholder="请选择参观场馆">
                                <option value="1">嘉定气象科普馆</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="remark" class="control-label col-sm-2 col-sm-offset-2" style="color:white">备注：</label>
                        <div class="col-sm-6">
                            <textarea class="form-control input-lg" id="remark" name="remark"></textarea>
                        </div>
                    </div>
                    <div class="form-group text-center">
                        <input type="button" value="修  改" class="btn btn-primary" onclick="editOrder()">
                        <input type="reset" value="撤  销" class="btn btn-primary" onclick="repealOrder">
                    </div>
                </form>
            </div>
            <!--<div class="col-xs-12 footer text-center">
                <div class="animate fadeInLeft">
                    <p> &copy; 2016 Themes Industry,  All rights reserved. </p>
                </div>
            </div>-->
        </div>
    </div>
</div>
<!-- RESERVEDSEC -->
<div id="RESERVEDSEC" class="row section" th:height="798px">
    <div class="container contact">
        <div class="col-xs-12 text-center">
            <div class="animate fadeInRight">
                <div class="heading">
                    <h1>有效预约信息</h1>
                    <p>请认真填写参观预约信息</p>
                </div>
            </div>
            <div id="reserved">  &lt;!&ndash; col-xs-12 col-sm-9 col-md-6 col-lg-3   col-sm-6 &ndash;&gt;
                <form class="form-horizontal" id="reservedFm">
                    <div class="form-group">
                        <label for="name" class="control-label col-sm-2 col-sm-offset-2" style="color:white">预约人姓名：</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control input-lg" id="name" name="name" placeholder="请填写预约人姓名">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="telephone" class="control-label col-sm-2 col-sm-offset-2" style="color:white">预约人电话：</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control input-lg" id="telephone" name="telephone" placeholder="请输入您的手机号码">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="adult" class="control-label col-sm-2 col-sm-offset-2" style="color:white">成人人数：</label>
                        <div class="col-sm-6">
                            <input type="number" class="form-control input-lg" id="adult" name="adult" placeholder="请输入成人人数" min="0" value="0" onblur="getTime()">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="child" class="control-label col-sm-2 col-sm-offset-2" style="color:white">儿童人数：</label>
                        <div class="col-sm-6">
                            <input type="number" class="form-control input-lg" id="child" name="child" placeholder="请输入儿童人数" min="0" value="0" onblur="getTime()">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="subscribe_time_id" class="control-label col-sm-2 col-sm-offset-2" style="color:white">参观时间选择：</label>
                        <div class="col-sm-6">
                            <select id="subscribe_time_id" name="subscribe_time_id"  class="form-control input-lg">
                                &lt;!&ndash;<option th:each="time:${timeList}" th:value="${time.Id}" th:text="${time.time}"></option>&ndash;&gt;
                                &lt;!&ndash;<option value="-1">请选择合适的参观时间</option>&ndash;&gt;
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="venue" class="control-label col-sm-2 col-sm-offset-2" style="color:white">预约场馆：</label>
                        <div class="col-sm-6">
                            <select class="form-control input-lg" id="venue" name="venue" placeholder="请选择参观场馆">
                                <option value="1">嘉定气象科普馆</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="remark" class="control-label col-sm-2 col-sm-offset-2" style="color:white">备注：</label>
                        <div class="col-sm-6">
                            <textarea class="form-control input-lg" id="remark" name="remark"></textarea>
                        </div>
                    </div>
                    <div class="form-group text-center">
                        <input type="button" value="预  约" class="btn btn-primary" onclick="addOrder()">
                        <input type="reset" value="取  消" class="btn btn-primary">
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- RECOMMENDSEC -->
<div id="RECOMMENDSEC" class="row section">
    <div class="container-fluid work text-center">
        <div class="row">
            <div class="col-xs-12 text-center">
                <div class="animate fadeInRight">
                    <div class="head">
                        <h1 style="color: white">留言建议</h1>
                        <p>我们真诚希望您能提供宝贵建议</p>
                    </div>
                </div>
                <div class="col-xs-12 work_filter text-center">
                    <div class="row">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<a href="#." class="cd-top">TOP</a>

<!--JS File-->
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/bootstrap.min.js}"></script>
<script th:src="@{/js/jquery.circliful.min.js}"></script>
<script th:src="@{/js/jquery.mixitup.min.js}"></script>
<script th:src="@{/js/jquery.fancybox.js}"></script>
<script th:src="@{/js/waypoints.js}"></script>
<script th:src="@{/js/jquery.appear.js}"></script>
<script th:src="@{/js/jpushmenu.js}"></script>
<script th:src="@{/js/owl.carousel.js}"></script>
<script th:src="@{/js/functions.js}"></script>
<!--<script th:src="@{/js/vue.min.js}"></script>
<script th:src="@{/js/axios.min.js}"></script>-->

<script th:inline="javascript">
    /*<![CDATA[*/
    var reserve_sec = [[${session.RESERVE_SEC}]];
    var reserve_openid = [[${session.RESERVE_OPENID}]];
    /*]]>*/
</script>

<script>
    $(document).ready(function(){
        // 锚点跳转
        if(reserve_sec){
            location.hash=reserve_sec;
        }

        // 限制微信客户端查看
        /*var ua = navigator.userAgent.toLowerCase();
        var isWeixin = ua.indexOf('micromessenger') != -1;
        var isAndroid = ua.indexOf('android') != -1;
        var isIos = (ua.indexOf('iphone') != -1) || (ua.indexOf('ipad') != -1);

        if (!isWeixin) {
            //这里警告框会阻塞当前页面继续加载
            alert('已禁止本次访问：您必须使用微信内置浏览器访问本页面！');
            // 以下代码是用javascript强行关闭当前页面
            var opened = window.open('about:blank', '_self');
            opened.opener = null;
            opened.close();
        }*/

        $('#subscribe_time_id').on('click', function() {
            var adult = $('#adult').val();
            var child = $('#child').val();
            if (adult + child <= 0) {
                alert('请先输入参观人数');
                return false;
            }
        });

        $.ajax({
            type: "GET",
            url: "/wechat/reserveQuery",
            dataType: "json",
            success: function (data) {
                if (data.code === -1) {
                    alert('无记录');
                    $('#RESERVEDSEC').hide();
                } else if (data.code === 0) {
                    alert('有记录');
                    $('#RESERVEDSEC').show();
                }
                //alert(data.msg);
            },
            error: function (jqXHR) {
                console.log("Error: " + jqXHR.status);
            }
        });
    });

    /**
     * 成人、儿童输入框失去焦点联动预约时间查询
     */
    function getTime() {
        var adult = $('#adult').val();
        var child = $('#child').val();
        if (adult + child <= 0) {
            alert('请先输入参观人数');
            return false;
        }
        var subscribe_num = adult + child;
        $.ajax({
            type: "GET",
            url: "/wechat/getReserveTime?subscribe_num=" + subscribe_num,
            dataType: "json",
            success: function (data) {
                var optionstring = '';
                $.each(data, function(key,value){  //循环遍历后台传过来的json数据
                    optionstring += "<option value=\"" + value.id + "\" >" + value.time + "</option>";
                });
                $("#subscribe_time_id").html("<option value='-1'>请选择合适的参观时间</option>" + optionstring);
            },
            error: function (jqXHR) {
                console.log("Error: " + jqXHR.status);
            }
        });
    }

    /**
     * 预约
     */
    function addOrder() {
        $.ajax({
            url:"/wechat/reserve/doReserve",

            data:$('#reserveFm').serialize(),
            type:'post',
            success:function(data){
                if (data.code === 0) {
                    alert(data.msg);
                    $('#reserveFm').reset();
                }
            }
        })
    }

</script>

</body>
</html>